<?xml version="1.0" encoding="US-ASCII"?>

<!DOCTYPE rfc SYSTEM "http://xml2rfc.tools.ietf.org/authoring/rfc2629.dtd" [
<!ENTITY RFC2119 SYSTEM "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.2119.xml">
<!ENTITY RFC2474 SYSTEM "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.2474.xml">
<!ENTITY RFC2475 SYSTEM "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.2475.xml">
<!ENTITY RFC2597 SYSTEM "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.2597.xml">
<!ENTITY RFC2914 SYSTEM "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.2914.xml">
<!ENTITY RFC3168 SYSTEM "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.3168.xml">
<!ENTITY RFC3246 SYSTEM "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.3246.xml">
<!ENTITY RFC3260 SYSTEM "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.3260.xml">
<!ENTITY RFC3662 SYSTEM "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.3662.xml">
<!ENTITY RFC4594 SYSTEM "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.4594.xml">
<!ENTITY RFC5865 SYSTEM "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.5865.xml">
]>
<?xml-stylesheet type='text/xsl'
             href='http://xml2rfc.tools.ietf.org/authoring/rfc2629.xslt' ?>
<?rfc strict="yes" ?>
<?rfc toc="yes"?>
<?rfc tocdepth="4"?>
<?rfc symrefs="yes"?>
<?rfc sortrefs="yes" ?>
<?rfc compact="yes" ?>
<?rfc subcompact="no" ?>

<!-- Change the title here -->

<rfc category="std" docName="draft-york-dart-dscp-rtp-00" ipr="trust200902">
  
  <front>

    <title abbrev="Using DiffServ with RTP">Using Differentiated Services
    (DiffServ) With Real-time Communications Protocols</title>


    <author fullname="Dan York" initials="D." surname="York" role="editor">
      <organization>Internet Society</organization>
      <address>
        <postal>
          <street/>
          <city>Keene</city>
          <region>N.H.</region>
          <country>USA</country>
        </postal>
        <phone>+1-802-735-1624</phone>
        <email>dyork@lodestar2.com</email>
      </address>
    </author>
    
    <author fullname="David Black" initials="D." surname="Black">
      <organization>EMC</organization>

      <address>
        <postal>
          <street>176 South Street</street>
          <city>Hopkinton</city>
          <region>MA</region>
          <code>01748</code>
          <country>USA</country>
        </postal>

        <phone>+1 508 293-7953</phone>
        <email>david.black@emc.com</email>
      </address>
    </author>

    <author fullname="Cullen Jennings" initials="C." surname="Jennings">
      <organization>Cisco</organization>

      <address>
        <postal>
          <street>170 West Tasman Drive</street>
          <street>MS: SJC-21/2</street>
          <city>San Jose</city>
          <region>CA</region>
          <code>95134</code>
          <country>USA</country>
        </postal>
        <phone>+1 408 421-9990</phone>
        <email>fluffy@cisco.com</email>
      </address>
    </author>

    <date year="2014"/>

    <area>RAI</area>

    <workgroup>DiffServ Applied to Real-time Transports</workgroup>

    <keyword>DiffServ,DSCP,RAI</keyword>

    <abstract>
      <t>This document describes the interaction between Differentiated
      Services (DiffServ) network quality of service (QoS) functionality and
      real-time network communication, including communication based on the
      Real-time Transport Protocol (RTP). DiffServ is based on network nodes
      applying different forwarding treatments to packets whose IP headers are
      marked with different DiffServ Code Points (DSCPs). As a result, use of
      different DSCPs within a single traffic stream may cause transport
      protocol interactions (e.g., due to reordering). In addition, DSCP
      markings may be changed or removed between the traffic's source and
      destination. This document covers the implications of these DiffServ
      aspects for real-time network communication, including RTCWEB.</t>
    </abstract>
  </front>

  <middle>
    <section title="Introduction">
      <!-- Intro text is rather limited, copied from abstract - needs to be improved. -->

      <t>This document describes the interactions between Differentiated
      Services (DiffServ) network quality of service (QoS) functionality <xref
      target="RFC2475"/> and real-time network communication, including
      communication based on the Real-time Transport Protocol (RTP). DiffServ
      is based on network nodes applying different forwarding treatments to
      packets whose IP headers are marked with different DiffServ Code Points
      (DSCPs)<xref target="RFC2474"/>. As a result use of different DSCPs
      within a single traffic stream may cause transport protocol interactions
      (e.g., due to reordering). In addition, DSCP markings may be changed or
      removed between the traffic's source and destination. This document
      covers the implications of these DiffServ aspects for real-time network
      communication, including RTCWEB traffic.</t>

      <section title="Requirements Language">
        <t>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
        "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
        document are to be interpreted as described in <xref
        target="RFC2119">RFC 2119</xref>.</t>
      </section>
    </section>

    <section anchor="Background" title="Background">
      <t>[Editor's note: Should this section include a general description of
      real-time communications, including RTCWEB?]</t>

      <t>[Editor's note: The following paragraph needs to be expanded to
      better characterize the variety of types of traffic, and probably
      generalize beyond RTP.]</t>

      <t>For real-time network communication, the network traffic consists of
      RTP streams (or other real-time media (sub-)flows) that are carried in
      transport protocols such as UDP, TCP and SCTP over IP and network links.
      Multiple transport protocols may be used via encapsulation, e.g., SCTP
      in UDP. DiffServ functionality is applied via use of DSCPs in the DS
      field of the IP headers to select different per-hop forwarding behaviors
      at network nodes.</t>

      <section anchor="DiffServ" title="Differentiated Services (DiffServ)">
        <t>The DiffServ architecture is intended to enable scalable service
        discrimination in the Internet without the need for per-flow state and
        signaling at every hop or node. A variety of services may be built
        from a small, well-defined set of building blocks that are deployed in
        network nodes. The services may be either end-to-end or intra-domain;
        they include both those that can satisfy quantitative performance
        requirements (e.g., peak bandwidth) and those based on relative
        performance (e.g., "class" differentiation). Services can be
        constructed by a combination of: <list style="symbols">
            <t>classifying traffic and setting bits in an IP header field at
            network boundaries or hosts,</t>

            <t>using those bits to determine how packets are forwarded by the
            nodes inside the network, and</t>

            <t>conditioning the marked packets (e.g., metering, marking,
            shaping, policing) at network boundaries in accordance with the
            requirements or rules of each service.</t>
          </list>The requirements or rules of each service are set through
        administrative policy mechanisms. A network node that supports
        DiffServ includes a classifier that selects packets based on the value
        of the DS field in IP headers, along with buffer management and packet
        scheduling mechanisms capable of delivering the specific packet
        forwarding treatment indicated by the DS field value. Setting of the
        DS field and fine-grain conditioning of marked packets need only be
        performed at network boundaries; internal network nodes operate on
        traffic aggregates that share a DS field value or in some cases, a
        small set of related values.</t>

        <t>The DiffServ architecture<xref target="RFC2475"/> is comprised of
        three primary functional elements that are implemented in network
        nodes:</t>

        <t><list style="numbers">
            <t>a small set of per-hop forwarding treatments or behaviors
            (per-hop behaviors, PHBs),</t>

            <t>packet classification functions, and</t>

            <t>traffic conditioning functions including metering, marking,
            shaping, and policing.</t>
          </list></t>

        <t>The architecture maintains distinctions among:<list style="symbols">
            <t>the service provided to a traffic aggregate,</t>

            <t>the conditioning functions and per-hop behaviors used to
            realize services,</t>

            <t>the DS field value (DS codepoint, or DSCP) used to mark packets
            to select a per-hop behavior, and</t>

            <t>the particular implementation mechanisms that realize a per-hop
            behavior.</t>
          </list></t>

        <t>This document focuses on PHBs and the usage of DSCPs to obtain
        those behaviors. In a network node's forwarding path, the DSCP
        contained in a field in the IP packet header is mapped to a particular
        forwarding treatment, or per-hop behavior (PHB) that specifies the
        forwarding treatment.</t>

        <t>A per-hop behavior (PHB) is a description of the externally
        observable forwarding behavior of a network node applied to network
        traffic marked with the corresponding DSCP for that network. In this
        context, "forwarding behavior" is a general - for example, if only one
        DSCP is used for all traffic on a link, the observable forwarding
        behavior (e.g., loss, delay, jitter) will often depend only on the
        relative loading of the link. To obtain useful behavioral multiple
        traffic subsets are marked with different DSCPs for different PHBs to
        which node resources such as buffer space and bandwidth are allocated.
        PHBs provide the framework for a DiffServ network node to allocates
        resources to traffic subsets, and useful differentiated services are
        constructed top of this basic hop-by-hop (per-node) resource
        allocation mechanism.</t>

        <t>The codepoints (DCSPs) may be chosen from a set of mandatory values
        (the class selector codepoints), from a set of recommended values
        defined in PHB specifications, or may have purely local meaning. The
        mandatory DSCPs are the class selector code points as specified in
        <xref target="RFC2474"/>. The class selector codepoints (CS0-CS7)
        extend the deprecated IP Precedence field in the IPv4 header; three
        bits are added, so that the class selector DSCPs are of the form
        'xxx000'. The all-zero DSCP ('00000') designates a Default PHB that
        provides best-effort forwarding behavior and the remaining class
        selector code points were originally specified to provide relatively
        better per-hop-forwarding behavior in increasing numerical order,
        but:<list style="symbols">
            <t>There is no requirement that any two adjacent class selector
            codepoints provide different PHBs; adjacent class selector
            codepoints may use the same pools of resources on each network
            node in some networks.</t>

            <t>CS1 ('001000') was subsequently recommended for "less than best
            effort" service when such a service is offered by a network <xref
            target="RFC3662"/>. Not all networks offer such a service.</t>
          </list></t>

        <t>Applications and traffic sources in general cannot rely upon
        different class selector codepoints providing differentiated services
        or upon the presence of a "less than best effort" service that is
        selected by the CS1 DSCP.</t>
      </section>

      <section anchor="DiffServPHBs" title="Diffserv PHBs (Per-Hop Behaviors)">
        <t>Although Differentiated Services is a general architecture that may
        be used to implement a variety of services, three fundamental
        forwarding behaviors (PHBs) have been defined and characterized for
        general use. These are:<list style="numbers">
            <t>Default Forwarding (DF) for elastic traffic <xref
            target="RFC2474"/>. The Default PHB is always selected by the
            all-zero DSCP.</t>

            <t>Assured Forwarding (AF) <xref target="RFC2597"/> to provide
            differentiated service to elastic traffic. Each instance of the AF
            behavior consists of three PHBs that differ only in drop
            precedence, e.g., AF11, AF12 and AF13; such a set of three AF PHBs
            is referred to as an AF class, e.g., AF1x. There are four defined
            AF classes, AF1x through AF4x.</t>

            <t>Expedited Forwarding (EF) <xref target="RFC3246"/>intended for
            inelastic traffic. Beyond the basic EF PHB, the VOICE-ADMIT PHB
            <xref target="RFC5865"/> is an admission controlled variant of the
            EF PHB.</t>
          </list></t>
      </section>

      <section anchor="DiffServAndTransport"
               title="DiffServ and Transport Protocols">
        <t>[Editor's note: This section is centered on TCP, UDP, and SCTP. It
        will need some generalization to include other important transport
        protocols - DCCP is a likely one to include, although it is not
        necessary to include every known transport protocol.]</t>

        <t>Transport protocols provide data communication behaviors beyond
        those possible at the IP layer. An important example is that TCP
        provides reliable in-order delivery of a data stream with congestion
        control. SCTP provides additional properties such as preservation of
        message boundaries, and the ability to avoid head-of-line blocking
        that may occur with TCP. In contrast, UDP is a basic unreliable
        datagram protocol whose primary functionality is port-based
        multiplexing and demultiplexing on top of IP.</t>

        <t>Transport protocols that provide in-order delivery and especially
        reliable in-order delivery for traffic or traffic subsets (e.g., TCP,
        SCTP) are sensitive to network reordering of traffic. At a minimum,
        when a protocol that provides reliable in-order delivery does receive
        a packet other than the next expected packet for an ordered connection
        or stream, it cannot deliver that subsequent packet. In this
        situation, such protocols usually assume that the expected packet has
        been lost and respond with a retransmission request for that packet.
        In addition, congestion control functionality in transport protocols
        usually infers congestion when packets are lost, creating an
        additional sensitivity to significant reordering - such reordering may
        be (mis-)interpreted as indicating congestion-caused packet loss,
        causing a reduction in transmission rate. This remains true even when
        ECN <xref target="RFC3168"/> is in use, as extreme congestion may
        still cause packet losses, which transport protocols react to as
        indicating congestion. Congestion control is an important aspect of
        the Internet architecture, see <xref target="RFC2914"/> for further
        discussion.</t>

        <t>In general, marking traffic with different DSCPs result in
        different PHBs being applied at network nodes, making reordering
        possible due to use of different pools of forwarding resources for
        each PHB. The major exception is that the reordering is prohibited
        within each AF class (e.g., AF1x); this is because the three PHBs in
        an AF class are required to differ solely in drop precedence.
        Reordering within a PHB or AF class may occur for other transient
        reasons (e.g., route flap). UDP is the primary transport protocol that
        is not sensitive to reordering in the network, because it does not
        provide reliable delivery, in-order delivery or congestion
        control.</t>
      </section>

      <section title="Traffic Classifiers and DSCP Remarking">
        <t>[David: Main points to make here: Network core uses BA Classifier
        (DSCP only). Network edge uses MF classifier, typically 5-tuple,
        although RFC 2475 allows DSCP to be a classifier input. Remarking
        occurs on aggregate/flows/packets selected by classifier. Can lose
        differentiation at any point (backbone networks often carry a small
        number of behavioral aggregates). Using multiple DSCPs within a
        5-tuple is asking for an MF classifier to remove that
        differentiation.]</t>

        <t>DSCP markings are not end-to-end in general. Each network is free
        to make its own decisions about what PHBs to use and what DSCP
        corresponds to each PHB. While every PHB specification includes a
        recommended DSCP, and RFC 4594 <xref target="RFC4594"/> recommends
        their end-to-end usage, beyond the class selector codepoints, there is
        no requirement that every network support any other PHBs or use any
        DSCPs. When DiffServ is used, the edge or boundary nodes of a are
        responsible for ensuring that all traffic entering a network conforms
        to that network's policies for DSCP and PHB usage; this network
        ingress traffic conditioning is a function of the classification,
        marking and related traffic conditioning functionality at network
        boundaries mentioned in Section <xref format="counter"
        target="DiffServ"/> and is an important element of the DiffServ
        architecture, see <xref target="RFC2475"/>. Hence DSCP remarking is
        possible at any network boundary, including the first network node
        that traffic sent by a host encounters.</t>

        <t>The traffic classifiers that are used for this purpose often do not
        look beyond the traffic's 5-tuple (source and destination IP
        addresses, transport protocol, source and destination ports). This is
        the case even though the definition of MF classifiers (Multi-Flow
        classifiers) in RFC 2475<xref target="RFC2475"/> allows arbitrary
        fields as input - in practice, the DSCP is typically not one of those
        fields. As a result, when multiple DSCPs are used for network traffic
        that shares a 5-tuple, remarking at a network boundary may result in
        all of the traffic being forwarded with a single DSCP, removing any
        differentiation within the 5-tuple beyond the point at which this
        remarking occurs.</t>

        <t>[Editor's note: Even an AF class doesn't fare well, as the
        AF-&gt;AF remarking may be "color-blind" as opposed to "color-aware" -
        not sure whether this level of detail belongs in this draft.]</t>

        <t>Backbone and other carrier networks may employ a small number of
        DSCPs (e.g., less than half a dozen) in order to manage a small number
        of traffic aggregates; hosts that use a much larger number of DSCPs
        may find that much of the intended differentiation is removed by such
        networks.</t>

        <t>[Editor's note: Need to double-check preceding paragraph with
        network operators.]</t>
      </section>
    </section>

    <section anchor="RTP" title="Background on Usage of RTP">
      <t>(This section will provide explain about the needs of RTP.)</t>

      <t>[Key point to DLB is *why* people want to do muxing in RTCWEB. Also
      critical is the *terminology* used in RTCWEB for the different layers
      and protocols so that DLB can use appropriate terms in response.]</t>

      <t>[DY: Potential drafts that seem like they would be useful to
      reference include:</t>

      <t>-
      http://tools.ietf.org/html/draft-ietf-mmusic-sdp-bundle-negotiation-05</t>

      <t>- http://tools.ietf.org/html/draft-ietf-rtcweb-rtp-usage-14</t>

      <t>- http://tools.ietf.org/html/draft-ietf-rtcweb-transports-02</t>

      <t>]</t>

      <!--

Explain:

RTP has timing information in so two different flows, one for audio, and one for video, 
can be later synchronized and played at same time even if they got significantly 
reordered. 

Mention of jitter buffers. 

Mention data channel as well as RTP.

-->

      <!--
-->
    </section>

    <section anchor="Recommendations" title="Recommendations">
      <t>TODO</t>

      <!--David: Moving this sub-section from Section 3 to Recommendations in Section 4

    <section anchor="fivetuple" title="RTP, UDP, DiffServ and 5-tuples">
    <t>[DLB: This is where the RTP/UDP multiplex onto a single 5-tuple
   discussion goes.  It gets followed by a warning that MF classifiers
   (see RFC 2475) are unlikely to look at DSCP within 5-tuple, and hence
   are likely to remove differentation within 5-tuple - this gets put in
   context by pointing out that DSCP remarking is common, and hence
   differentiation can vanish for all sorts of other reasons.]</t>
    </section>
-->

      <!--
-->

      <t>[DY: Key point for DLB to write here - how does DiffServ apply to the
      muxing over UDP described in the section above?]</t>

      <t>[DLB: Within a stream for a transport protocol that is sensitive to
      reordering, i.e., everything but UDP, SHOULD only mix DSCPs/PHBs within
      a single AF class.]</t>
    </section>

    <section anchor="RTCWEB" title="RTCWEB Examples">
      <t>(This section will provide examples of DiffServ/DSCP limitations with
      regard to RTCWEB.)</t>

      <!--

Explain why the we can't do local network configuration of values used 

-->
    </section>

    <section anchor="Acknowledgements" title="Acknowledgements">
      <t>This document is the result of many conversations that have occurred
      within multiple RAI and TRANSPORT area working groups. Thanks for review
      and text from James Polk.</t>
    </section>

    <section anchor="IANA" title="IANA Considerations">
      <t>This document includes no request to IANA.</t>
    </section>

    <section anchor="Security" title="Security Considerations">
      <t>(Need to understand if there are any security considerations to
      include.)</t>

      <!-- 

Do we need to say anything about how munging DSCP can mess things up ?


-->

      <t>[DLB: Multiplexing of streams onto same UDP 5-tuple may not be
      expected by network operational/monitoring/security tools, making it
      easier to hide things?]</t>
    </section>
  </middle>

  <back>
    <references title="Normative References">
      &RFC2119;
    </references>

    <references title="Informative References">
      <!--Most of the important DiffServ RFCs are referenced here. Need to decide which ones are normative.-->

      &RFC2474;

      &RFC2475;

      &RFC2597;

      &RFC2914;

      &RFC3168;

      &RFC3246;

      &RFC3662;

      &RFC4594;

      &RFC5865;

      <!-- Pointers to appropriate RTCWEB documents? -->
    </references>
  </back>
</rfc>
