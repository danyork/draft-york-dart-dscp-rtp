<?xml version="1.0" encoding="US-ASCII"?>

<!DOCTYPE rfc SYSTEM "http://xml.resource.org/authoring/rfc2629.dtd" [
<!ENTITY RFC2119 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.2119.xml">
<!ENTITY RFC2474 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.2474.xml">
<!ENTITY RFC2475 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.2475.xml">
<!ENTITY RFC2597 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.2597.xml">
<!ENTITY RFC3168 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.3168.xml">
<!ENTITY RFC3246 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.3246.xml">
<!ENTITY RFC3260 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.3260.xml">
<!ENTITY RFC3662 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.3662.xml">
<!ENTITY RFC5865 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.5865.xml">
]>
<?xml-stylesheet type='text/xsl'
             href='http://xml.resource.org/authoring/rfc2629.xslt' ?>
<?rfc strict="yes" ?>
<?rfc toc="yes"?>
<?rfc tocdepth="4"?>
<?rfc symrefs="yes"?>
<?rfc sortrefs="yes" ?>
<?rfc compact="yes" ?>
<?rfc subcompact="no" ?>

<!-- Change the title here -->

<rfc category="std" docName="draft-york-dart-dscp-rtp-00" ipr="trust200902">
  
  <front>

    <title abbrev="Using DiffServ with RTP">Using Differentiated Services
    (DiffServ) With Real-time Communications Protocols</title>


    <author fullname="Dan York" initials="D." surname="York" role="editor">
      <organization>Internet Society</organization>
      <address>
        <postal>
          <street/>
          <city>Keene</city>
          <region>N.H.</region>
          <country>USA</country>
        </postal>
        <phone>+1-802-735-1624</phone>
        <email>dyork@lodestar2.com</email>
      </address>
    </author>
    
    <author fullname="David Black" initials="D." surname="Black">
      <organization>EMC</organization>

      <address>
        <postal>
          <street>176 South Street</street>
          <city>Hopkinton</city>
          <region>MA</region>
          <code>01748</code>
          <country>USA</country>
        </postal>

        <phone>+1 508 293-7953</phone>
        <email>david.black@emc.com</email>
      </address>
    </author>

    <author fullname="Cullen Jennings" initials="C." surname="Jennings">
      <organization>Cisco</organization>

      <address>
        <postal>
          <street>170 West Tasman Drive</street>
          <street>MS: SJC-21/2</street>
          <city>San Jose</city>
          <region>CA</region>
          <code>95134</code>
          <country>USA</country>
        </postal>
        <phone>+1 408 421-9990</phone>
        <email>fluffy@cisco.com</email>
      </address>
    </author>

    <date year="2014"/>

    <area>RAI</area>

    <workgroup>DiffServ Applied to Real-time Transports</workgroup>

    <keyword>DiffServ,DSCP,RAI</keyword>

    <abstract>
      <t>This document describes the interaction between Differentiated
      Services (DiffServ) network quality of service (QoS) functionality and
      real-time network communication, including communication based on the
      Real-time Transport Protocol (RTP). DiffServ service differentiation is
      based on network nodes applying different forwarding treatments to
      packets whose IP headers are marked with different DiffServ Code Points
      (DSCPs), so use of different DSCPs may cause transport protocol
      interactions (e.g., due to reordering). In addition, DSCP markings may
      be changed or removed between the source and destination of network
      traffic. This document covers the implications of these DiffServ aspects
      for real-time network communicatio, including RTCWEB traffic.</t>
      
    </abstract>
  </front>

  <middle>
    <section title="Introduction">
    
      <!-- Initial intro text taken from the DART charter.  Needs to be improved. -->
          
      <t>This document describes the interactions between Differentiated
      Services (DiffServ) network quality of service (QoS) functionality <xref
      target="RFC2475"/>and real-time network communication, including
      communication based on the Real-time Transport Protocol (RTP). DiffServ
      service differentiation is based on network nodes applying different
      forwarding treatments to packets whose IP headers are marked with
      different DiffServ Code Points (DSCPs)<xref target="RFC2474"/>, so use
      of different DSCPs may cause transport protocol interactions (e.g., due
      to reordering). In addition, DSCP markings may be changed or removed
      between the source and destination of network traffic. This document
      covers the implications of these DiffServ aspects for real-time network
      communication, including RTCWEB traffic.</t>

      <section title="Requirements Language">
        <t>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
        "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
        document are to be interpreted as described in <xref
        target="RFC2119">RFC 2119</xref>.</t>
      </section>
    </section>

 
    <section anchor="Background" title="Background">  
    
    <t>[Should this section include a general description of real-time
    communications, including RTCWEB?]</t>
    
    <t>[This paragraph needs to be expanded to better characterize the
      variety of traffic.] For real-time network communication, the network
      traffic consists of RTP streams (or other real-time media (sub-)flows)
      that are carried in transport protocols such as UDP, TCP and SCTP over
      IP and network links. Multiple transport protocols may be used via
      encapsulation, e.g., SCTP in UDP. Diffserv functionality is applied via
      use of DSCPs in the DS field of the IP headers to select different
      per-hop forwarding behaviors at network nodes.</t>
   
   <section anchor="DiffServ" title="Differentiated Services (DiffServ)">
   
   <t>The Diffserv architecture<xref target="RFC2475"/> is comprised of
        three primary functional elements that are implemented in network
        nodes:</t>

        <t><list style="numbers">
            <t>a small set of per-hop forwarding behaviors (per-hop behaviors,
            PHBs),</t>

            <t>packet classification functions, and</t>

            <t>traffic conditioning functions including metering, marking,
            shaping, and policing.</t>
          </list></t>

        <t>Complex classification and conditioning functions are implemented
        only at network boundary nodes; interior nodes apply per-hop behaviors
        to aggregates of traffic that have been appropriately marked using the
        DS field in the IPv4 or IPv6 headers <xref target="RFC2474"/>. Per-hop
        behaviors provide a coarse grained means of allocating buffer and
        bandwidth resources at each node among competing traffic so that
        per-application flow or per-customer forwarding state need not be
        maintained within the core of the network.</t>

        <t>The architecture maintains distinctions among:<list style="symbols">
            <t>the service provided to a traffic aggregate,</t>

            <t>the conditioning functions and per-hop behaviors used to
            realize services,</t>

            <t>the DS field value (DS codepoint, or DSCP) used to mark packets
            to select a per-hop behavior, and</t>

            <t>the particular implementation mechanisms that realize a per-hop
            behavior.</t>
          </list></t>

        <t>This document focuses on usage of DSCPs and PHBs. In the forwarding
        path, differentiated services are realized by mapping the DSCP
        contained in a field in the IP packet header to a particular
        forwarding treatment, or per-hop behavior (PHB), at each network node
        along its path. The codepoints may be chosen from a set of mandatory
        values (the class selector codepoints), from a set of recommended
        values defined in PHB specifications, or may have purely local
        meaning.</t>

        <t>A per-hop behavior (PHB) is a description of the externally
        observable forwarding behavior of a network node applied to network
        traffic marked with the corresponding DSCP for that network.
        "Forwarding behavior" is a general concept in this context. For
        example, in the event that only one DSCP is used for all traffic on a
        link, the observable forwarding behavior (e.g., loss, delay, jitter)
        will often depend only on the relative loading of the link (i.e., in
        the event that the behavior assumes a work-conserving scheduling
        discipline). Useful behavioral distinctions are mainly observed when
        multiple traffic subsets marked with different DSCPs compete for
        buffer and bandwidth resources on a node. The PHB is the means by
        which a network node allocates resources to traffic subsets, and it is
        on top of this basic hop-by-hop resource allocation mechanism that
        useful differentiated services may be constructed.</t>

        <t>The mandatory DSCPs are the class selector code points as specified
        in <xref target="RFC2474"/>. The class selector codepoints (CS0-CS7)
        extend the deprecated IP Precedence field in the IPv4 header; three
        bits are added, so that the class selector DSCPs are of the form
        'xxx000'. The all-zero DSCP ('00000') designates a Default PHB that
        provides best-effort forwarding behavior and the remaining class
        selector code points were originally specified to provide relatively
        better per-hop-forwarding behavior in increasing numerical order,
        but:<list style="symbols">
            <t>There is no requirement that any two adjacent class selector
            codepoints provide different PHBs.</t>

            <t>CS1 ('001000') was subsequently recommended for use with a
            "less than best effort" service when one is offered by a network
            <xref target="RFC3662"/>.</t>
          </list></t>

        <t>Applications and other sources of traffic cannot rely upon
        different class selector codepoints providing differentiated services
        or upon the presence of a "less than best effort" service that is
        selected by CS1.</t>

        <t>While Differentiated Services is a general architecture that may be
        used to implement a variety of services, three fundamental forwarding
        behaviors have been defined and characterized for general use. These
        are basic Default Forwarding (DF) behavior for elastic traffic <xref
        target="RFC2474"/>, the Assured Forwarding (AF) behavior <xref
        target="RFC2597"/>, and the Expedited Forwarding (EF) behavior <xref
        target="RFC3246"/>intended for inelastic traffic. Each instance of AF
        consists of three PHBs, with associated recommended DSCPs that differ
        only in drop precedence, e.g., AF11, AF12 and AF13; this set of PHBs
        and recommended DSCPs is referred to as an AF class, e.g., AF1x. There
        are four recommended AF classes, AF1x through AF4x. One PHB and and
        associated recommended DSCP are recommended for EF and likewise for
        the admission-controlled variant of the EF PHB, VOICE-ADMIT <xref
        target="RFC5865"/>.</t>

        <t>In general, traffic marked with different DSCPs result in different
        DSCPs being applied. In this case, network node reordering of packets
        with dfferent DSCPs is possible at network nodes due to the use of
        different sets of forwarding resources for each PHB. The sole
        exception is that the reordering is prohibited within each AF class
        (e.g., AF1x); this is because the three PHBs in an AF class differ
        solely in drop precedence. Reordering may occur for other transient
        reasons (e.g., route flap).</t>
   
   </section>
    
    <section anchor="DiffServAndTransport" title="DiffServ and Transport Protocols"> 
      <t>Transport protocols exist to provide behaviors that cannot be
        provided at the IP layer. For example, the need for the combination of
        reliable in-order delivery (to a receiving application) wiht
        congestion control resulted in TCP. There are now multiple transport
        protocols (i.e., TCP, UDP, SCTP, etc.) that provide different
        behaviors.</t>

        <t>[David: Need some text here on important characteristics of some
        transport protocols - the three key ones are in-order delivery,
        reliable delivery, and congestion control. Include text on the
        importance of congestion control. Should we limit discussion to TCP,
        SCTP, UDP here?]</t>

        <t>Transport protocols that provide in-order delivery and especially
        reliable in-order delivery for traffic or traffic subsets (e.g., TCP,
        SCTP) are sensitive to reordering of traffic with in the network. At a
        minimum, when a protocol that provides reliable delivery does not
        receive the expected next packet for an ordered connection or stream,
        as indicated by receipt of a subsequent packet, it cannot deliver that
        subsequent packet. Although waiting for the packet to arrive
        out-of-order is possible, reliable delivery protocols usually assume
        that the packet has been lost and respond with a retransmission
        request for the missing packet. Transport protocols that provide
        congestion control generally use lost packets to infer congestion
        (even when ECN <xref target="RFC3168"/> is in use), and hence are
        sensitive to significant reordering that may be (mis-)interpreted as
        indicating congestion-caused packet loss, causing a reduction in
        transmission rate.</t>

        <t>[David: Say something about in-order unreliable delivery? Is that
        germane to the real-time communication context of this draft?] </t>

        <t>In general, UDP is the only transport protocol that is not
        sensitive to reordering in the network, as it provides neither
        reliable delivery, in-order delivery or congestion control; UDP is a
        relatively simple multiplexing/demultiplexing protocol that provides
        multiple datagram ports for a single IP address.</t>
     </section>
     
     <section title="Traffic Classifiers and Remarking">
        <t>[David: Main points to make here: Network core uses BA Classifier
        (DSCP only). Network edge uses MF classifier, typically 5-tuple,
        although RFC 2475 allows DSCP to be a classifier input. Remarking
        occurs on aggregate/flows/packets selected by classifier. Can lose
        differentiation at any point (backbone networks often carry a small
        number of behavioral aggregates). Using multiple DSCPs within a
        5-tuple is asking for an MF classifier to remove that
        differentiation.]</t>
      </section>
     
    </section>  
    
    <section anchor="RTP" title="Background on Usage of RTP">
      <t>(This section will provide explain about the needs of RTP.</t>

<!--

Explain:

RTP has timing information in so two differnt flows, one for audio, and one for video, can be later syncronized and played at same time even if they got significnatly reorded. 

Mention of jitter buffers. 

Mention data channel as well as RTP

-->

<-- DY: We had this sub-section in here. Are we now moving this to the
recommendations?

    <section anchor="fivetuple" title="RTP, UDP, DiffServ and 5-tuples">
    <t>[DLB: This is where the RTP/UDP multiplex onto a single 5-tuple
   discussion goes.  It gets followed by a warning that MF classifiers
   (see RFC 2475) are unlikely to look at DSCP within 5-tuple, and hence
   are likely to remove differentation within 5-tuple - this gets put in
   context by pointing out that DSCP remarking is common, and hence
   differentiation can vanish for all sorts of other reasons.]</t>
    </section>

-->
    
    </section>

    <section anchor="Recommendations" title="Recommendations">
      <t>TODO</t>

<!--
Warning about CS1 reorded 
-->

   <t>[DLB: Within a stream for a transport protocol that is sensitive to
   reordering, i.e., everything but UDP, SHOULD only mix DSCPs/PHBs within
   a single AF class.]</t>


    </section>

    <section anchor="RTCWEB" title="RTCWEB Examples">
      <t>(This section will provide examples of DiffServ/DSCP limitations with
      regard to RTCWEB.)</t>

<!--

Explain why the we can't do local network configuration of values used 

-->

    </section>   
    
    <section anchor="Acknowledgements" title="Acknowledgements">
      <t>This document is the result of many conversations that have occurred within
      multiple RAI and TRANSPORT area working groups. Thanks for review and text 
      from James Polk. </t>

    </section>

    <section anchor="IANA" title="IANA Considerations">
      <t>This document includes no request to IANA.</t>

    </section>

    <section anchor="Security" title="Security Considerations">
      <t>(Need to understand if there are any security considerations to include.)</t>

<!-- 

Do we need to say anything about how munnging DSCP can mess things up ?


-->
      
    <t>[DLB: Multiplexing of streams onto same UDP 5-tuple may not be
   expected by network operational/monitoring/security tools, making
   it easier to hide things?]</t>
      
    </section>
  </middle>

 
  <back>

    <references title="Normative References">
      &RFC2119;
    </references>

    <references title="Informative References">

      <!-- Need pointers to DiffServ-related RFCs and drafts. Three are listed here as 
      examples, but the proper list should be identified. -->
       
       &RFC2474;
       &RFC2475; 
       &RFC2597;
       &RFC3168;
       &RFC3246;      
       &RFC3260; 
       &RFC3662;
       &RFC5865;
      <!-- Pointers to appropriate RTCWEB documents? -->
      
    </references>

  
  </back>
</rfc>