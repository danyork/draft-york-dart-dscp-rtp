<?xml version="1.0" encoding="US-ASCII"?>

<!DOCTYPE rfc SYSTEM "http://xml.resource.org/authoring/rfc2629.dtd" [
<!ENTITY RFC2119 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.2119.xml">
<!ENTITY RFC2474 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.2474.xml">
<!ENTITY RFC2475 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.2475.xml">
<!ENTITY RFC3260 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.3260.xml">
]>
<?xml-stylesheet type='text/xsl'
             href='http://xml.resource.org/authoring/rfc2629.xslt' ?>
<?rfc strict="yes" ?>
<?rfc toc="yes"?>
<?rfc tocdepth="4"?>
<?rfc symrefs="yes"?>
<?rfc sortrefs="yes" ?>
<?rfc compact="yes" ?>
<?rfc subcompact="no" ?>

<!-- Change the title here -->

<rfc category="info" docName="draft-york-dart-dscp-rtp-00" ipr="trust200902">
  
  <front>

    <title abbrev="Limitations of Using DiffServ And DSCP With RTP">Limitations of Using 
    Differentiated Services (DiffServ) With Real-time Communications Protocols</title>


    <author fullname="Dan York" initials="D." surname="York" role="editor">
      <organization>Internet Society</organization>
      <address>
        <postal>
          <street></street>
          <city>Keene</city>
          <region>N.H.</region>
          <country>USA</country>
        </postal>
        <phone>+1-802-735-1624</phone>
        <email>dyork@lodestar2.com</email>
      </address>
    </author>
    
    <author fullname="David Black" initials="D." surname="Black">
      <organization>EMC</organization>

      <address>
        <postal>
          <street>176 South Street</street>
          <city>Hopkinton</city>
          <region>MA</region>
          <code>01748</code>
          <country>USA</country>
        </postal>

        <phone>+1 508 293-7953</phone>
        <email>david.black@emc.com</email>
      </address>
    </author>

    <author fullname="Cullen Jennings" initials="C." surname="Jennings">
      <organization>Cisco</organization>

      <address>
        <postal>
          <street>170 West Tasman Drive</street>
          <street>MS: SJC-21/2</street>
          <city>San Jose</city>
          <region>CA</region>
          <code>95134</code>
          <country>USA</country>
        </postal>
        <phone>+1 408 421-9990</phone>
        <email>fluffy@cisco.com</email>
      </address>
    </author>

<<<<<<< HEAD
    <date year="2014" month="March" day="6" />
=======
    
    <date year="2014" month="April" day="1" />
>>>>>>> 32b6fa2c3e1c7bf24a02f3ba8e7fd848862d0d14

    <area>RAI</area>

    <workgroup>DiffServ Applied to Real-time Transports</workgroup>

    <keyword>DiffServ,DSCP,RAI</keyword>

    <abstract>
      <t>This document explains the interaction between DiffServ, DiffServ Code Points
      (DSCP) and real-time communication protocols such as the Real-time Transport Protocol 
      (RTP).  This document explains the limitations that exist with DiffServ and DSCP
      when used with RTP in general as well as in specific RTCTWEB cases.</t>
      
    </abstract>
  </front>

  <middle>
    <section title="Introduction">
    
      <!-- Initial intro text taken from the DART charter.  Needs to be improved. -->
          
      <t>Differentiated Services (DiffServ) and DiffServ code points (DSCP) can be used
in some situations to provide quality of service (QoS). Packets with different
markings can be reordered, which can cause poor interaction with a transport
protocol that is responsive to reordering. When RTP streams or other real-time
media (sub-)flows are used with different DSCP values with the same transport
5-tuple, there may be transport protocol interactions. There are also
environments where the DSCP markings are removed or remarked.</t>

      <section title="Requirements Language">
        <t>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
        "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
        document are to be interpreted as described in <xref
        target="RFC2119">RFC 2119</xref>.</t>
      </section>
    </section>

 
    <section anchor="Background" title="Background">  
    
    <t>[DLB: Describe protocol stack, from RTP streams (or other real-time media
   (sub-)flows down to RTP, UDP, IP.  DSCP is in the IP header - reference
   RFC 2474 for that and then RFC 2475 for Diffserv in general.  Make sure 
   to cite requirements that DSCPs be individually treated by network nodes.]</t>
   
   <section anchor="DiffServ" title="Differentiated Services (DiffServ)">
   
   <t>[DLB: Next two paragraphs are copied from RFC 2475:]</t>

   <t>This architecture is composed of a number of functional elements
   implemented in network nodes, including a small set of per-hop
   forwarding behaviors, packet classification functions, and traffic
   conditioning functions including metering, marking, shaping, and
   policing.  This architecture achieves scalability by implementing
   complex classification and conditioning functions only at network
   boundary nodes, and by applying per-hop behaviors to aggregates of
   traffic which have been appropriately marked using the DS field in
   the IPv4 or IPv6 headers [DSFIELD].  Per-hop behaviors are defined to
   permit a reasonably granular means of allocating buffer and bandwidth
   resources at each node among competing traffic streams.  Per-
   application flow or per-customer forwarding state need not be
   maintained within the core of the network.  A distinction is
   maintained between:</t>
   <t><list style="symbols">
   <t>the service provided to a traffic aggregate,</t>

   <t>the conditioning functions and per-hop behaviors used to realize
      services,</t>

   <t>the DS field value (DS codepoint) used to mark packets to select a
      per-hop behavior, and</t>

   <t>the particular node implementation mechanisms which realize a
      per-hop behavior.</t>
    </list></t>
  <t> Service provisioning and traffic conditioning policies are
   sufficiently decoupled from the forwarding behaviors within the
   network interior to permit implementation of a wide variety of
   service behaviors, with room for future expansion.</t>

   <t>[DLB: Next paragraph copied from RFC 2475, will need editing to 
   make terminology more accessible.]</t>

   <t>A per-hop behavior (PHB) is a description of the externally
   observable forwarding behavior of a DS node applied to a particular
   DS behavior aggregate.  "Forwarding behavior" is a general concept in
   this context.  For example, in the event that only one behavior
   aggregate occupies a link, the observable forwarding behavior (i.e.,
   loss, delay, jitter) will often depend only on the relative loading
   of the link (i.e., in the event that the behavior assumes a work-
   conserving scheduling discipline).  Useful behavioral distinctions
   are mainly observed when multiple behavior aggregates compete for
   buffer and bandwidth resources on a node.  The PHB is the means by
   which a node allocates resources to behavior aggregates, and it is on
   top of this basic hop-by-hop resource allocation mechanism that
   useful differentiated services may be constructed.</t>

   <t>[DLB: Next two paragraphs copied from RFC 4594.]</t>

   <t>While Differentiated Services is a general architecture that may be
   used to implement a variety of services, three fundamental forwarding
   behaviors have been defined and characterized for general use.  These
   are basic Default Forwarding (DF) behavior for elastic traffic, the
   Assured Forwarding (AF) behavior, and the Expedited Forwarding (EF)
   behavior for real-time (inelastic) traffic.  The facts that four code
   points are recommended for AF and that one code point is recommended
   for EF are arbitrary choices, and the architecture allows any
   reasonable number of AF and EF classes simultaneously.  </t>

   <t>The terms "elastic" and "real-time" are defined in [RFC1633], Section
   3.1, as a way of understanding broad-brush application requirements.
   This document should be reviewed to obtain a broad understanding of
   the issues in quality of service, just as [RFC2475] should be
   reviewed to understand the data plane architecture used in today's
   Internet.</t>

   <t>[DLB: Add discussion of class selector code points, see RFC 2474.
    Add a warning here that while CS1 is intended for less than best
    effort, that's not what always happens - many networks do not
    support a less-than-best-effort PHB.]</t>
   
   </section>
    
    <section anchor="DiffServAndTransport" title="DiffServ and Transport Protocols"> 
      <!-- This text taken from James Polk's email to DISPATCH to serve as a base -->
       
      <t>Various transport protocols exist today for various reasons; mostly because there 
      was a need for a behavior that the IP layer just could not provide, or a behavior 
      that another transport protocol didn't have (at the time, in some cases). For 
      example, both a type of congestion control and an ability to reorder at the 
      receiver out of order packets necessitated the need for the development of a 
      transport layer to handle both capabilities better. The result was TCP. There are 
      now multiple transport protocols (i.e., TCP, UDP, SCTP, etc.) that have various 
      behaviors. These behaviors are not the same depending on the network circumstance 
      a/each packet finds itself in as it traverses through the network.</t>

      <t>[DLB: Suggest removing next two paragraphs.  I'm not sure COS vs. QoS distinction is useful here]</t>
  
      <t>With the IP layer, and not part of the 5-tuple identifier, DiffServ code points 
      (DSCP) can be used in situations to provide quality of service (QoS), but in fact 
      it is a class of service (COS) differentiation they provide. These 64 different 
      values are found within the old TOS byte. There is nothing in the DSCP field but 
      zeros most of the time (i.e., Best Effort). As specified within RFC 2474 and 2475 
      is called a per hop behavior (PHB). Hence most packets receive a best effort PHB. 
      An important aspect of a PHB is that it is just that, and a packet, and indirectly 
      its user, needs to be prepared to have its DSCP remarked to another value one or 
      more times, or any time it traverses a layer node.</t>

      <t>With the desire to now explore other than best effort DSCP markings of RTP 
      streams or other real-time media (sub-)flows, certain realities, say for example 
      reordering of packets within a stream or flow, not all transport protocols behave 
      the same. Some will have their DSCP of a non-zero value set to zero by some router 
      before the destination, or another non-zero value that is different from the packet 
      that it was originally set to.</t>
      
      <t>[DLB: Discuss effect of reordering on transport protocols.  In general
   any congestion controlled protocol is sensitive to reordering, UDP
   is the notable exception, as it's mux/demux only, no congestion or flow
   control.]</t>

   <t>[DLB: Discuss PHB/DSCP reordering effects - AF's use of multiple PHBs
   and DSCPs in an AF class PHB Group (e.g., AF2x) does not cause reordering,
   as they differ only in drop precedence; in general, all other usage of
   different PHBs may cause reordering.]</t>
     </section>
    </section>  
    
    <section anchor="RTP" title="Background on Usage of RTP">
      <t>(This section will provide explain about the needs of RTP.</t>

<!--

Explain:

RTP has timing information in so two differnt flows, one for audio, and one for video, can be later syncronized and played at same time even if they got significnatly reorded. 

Mention of jitter buffers. 

Mention data channel as well as RTP

-->
    <section anchor="fivetuple" title="RTP, UDP, DiffServ and 5-tuples">
    <t>[DLB: This is where the RTP/UDP multiplex onto a single 5-tuple
   discussion goes.  It gets followed by a warning that MF classifiers
   (see RFC 2475) are unlikely to look at DSCP within 5-tuple, and hence
   are likely to remove differentation within 5-tuple - this gets put in
   context by pointing out that DSCP remarking is common, and hence
   differentiation can vanish for all sorts of other reasons.]</t>
    </section>
    </section>

    <section anchor="Recomendations" title="Recomendations">
      <t>  TODO </t>

<!--
Warning about CS1 reorded 
-->

   <t>[DLB: Within a stream for a transport protocol that is sensitive to
   reordering, i.e., everything but UDP, SHOULD only mix DSCPs/PHBs within
   a single AF class.]</t>

   <t>[DLB: Here's where the text about mixing DSCPs (aside from single
    AF class) on a UDP 5-tuple goes - it needs to point back to 3.1 with
    a warning.]</t>


    </section>

    <section anchor="RTCWEB" title="RTCWEB Examples">
      <t>(This section will provide examples of DiffServ/DSCP limitations with
      regard to RTCWEB.)</t>

<!--

Explain why the we can't do local network configuraiton of valuses used 

-->

    </section>   
    
    <section anchor="Acknowledgements" title="Acknowledgements">
      <t>This document is the result of many conversations that have occurred within
      multiple RAI and TRANSPORT area working groups. Thanks for review and text from James Polk, TODO. </t>

    </section>

    <section anchor="IANA" title="IANA Considerations">
      <t>This document includes no request to IANA.</t>

    </section>

    <section anchor="Security" title="Security Considerations">
      <t>(Need to understand if there are any security considerations to include.)</t>

<!-- 

Do we need to say anything about how munnging DSCP can mess things up ?


-->
      
    <t>[DLB: Multiplexing of streams onto same UDP 5-tuple may not be
   expected by network operational/monitoring/security tools, making
   it easier to hide things?]</t>
      
    </section>
  </middle>

 
  <back>

    <references title="Normative References">

      &RFC2119;

      
    </references>

    <references title="Informative References">

      <!-- Need pointers to DiffServ-related RFCs and drafts. Three are listed here as 
      examples, but the proper list should be identified. -->
       
       &RFC2474;
       &RFC2475;       
       &RFC3260; 
       
      <!-- Pointers to appropriate RTCWEB documents? -->
      
    </references>

  
  </back>
</rfc>